# graduates

Электронная версия книги "Дипломы с отличием получили", находящейся в музее СФ МЭИ

## Сборка проекта


### build.sh

Чтобы упростить процесс сборки написан скрипт `build.sh`

В шапке скрипта константы:

`VENV_NAME="venv"` - имя директории с virtualenv

`REQ_FILE_NAME="req.txt"` - имя файла с зависимости (обычно `requirements.txt`, но мне было удобнее `req.txt`)

- Скрипт пытается подключиться в VENV_NAME если не получается, то создает новое окружение с имененм VENV_NAME
- Устанавливает зависимости python
- Удаляет содержимое директории `build`, если такой директории еще нет, создаёт её
- Запускает `build.py`
- Перемещает из корневой директории проекта `names_mapping.json` и `index.html` (генерирует скрипт `build.py`) в директорию `build`
- Создает директорию `build/static` и копирует в неё содержимое `graduates/static`

### build.py

#### генерация html разметки

Для генерации html разметки используется скрипт build.py

В шапке скрипта константы:

`ENTRIES_PER_PAGE` - строк на "страницу"

`ENTRIES_MIN_BEFORE_END` - используется для того, чтобы избежать случая, когда год попадает на одну страницу, а имена из этого года на другую. Указывает минимальное количество строк после года на странице, иначе записи будут перенесены на следующую страницу

`PAGE_TITLE` - содержимое тега `<title>` index страницы

`TITLE` - заголовок книги

`SUBTITLE` - подзаголовок книги

`SPEC_DIR` - директория с `.txt` файлами специалистов
`MAST_DIR` - директория с `.txt` файлами магистров

Зависимости для python скрипта в файле `req.txt`

#### генерация маппинга для поиска 

*Рубрика Dirty Hacks:* Теперь скрипт генерит `./names_mapping.json` с маппингом выпускников. Сделано для реализации фичи с поиском на клиентской стороне. Вообще этим, конечно, сервер должен заниматься, позже можно  вынести логику поиска на серверную часть.

структура `names_mapping.json`:
```json
[
    ["Иванов", "Иван", "Иванович", 1990, 1],
    ["Петров", "Петр", "Петрович", 1991, 2],
    ["Иванова", "Диана", "Олеговна", 2027, 10],
    ["ф", "и", "о", "год", "стр"]
]
```

Из-за этого решения получается небольшой венегрет: для единообразия теперь можно генерить файлик с маппингом годов на страницы (1), и строить содержимое ddMast и ddSpec на стороне клиента.

## Публикация

Используется GitLab CI/CD (ради "поиграться")

На gitlab создано зеркало репозитория https://gitlab.com/mikhailpashkov/sbmpei-graduates-book

Создана группа https://gitlab.com/sbmpei-group у которой есть maintainer доступ к репозиторию (завести mirror проект внутри группы не получилось, из коробки не завелось, разбираться было некогда).

Реализован простой pipeline на 2 стейджа: `build` `deploy`. Подробности в `.gitlab-ci.yml`

На стороне сервера нужно поднять **shell** GitLab Runner с тегом `staging`. Завести переменную окружения `WEB_ROOT` в которую записать полный путь до директории сайта (e.g. `/var/www/mikhailpashkov.site`). **Важно**, чтобы у пользователя `gitlab-runner` был rwx доступ в эту директорию, + перед первым запуском нужно туда что-нибудь положить иначе не отработает `rm -r $WEB_ROOT/*`.

## Файлы с информацией об "отличниках"

- Расширение: `.txt`
- Название: по номеру года: `год.txt` например: `1999.txt`
- Кодировка: UTF-8. [как правильно сохранять](http://u4ilka.kcbux.ru/Raznoe/raz-019-ut8.html)
- Содержание: список `ФИО – №гр`. Каждая запись с новой строки
- Файлы поместить в директории `specialists` (записи до раздела **магистры** книги) и `masters` (записи в разделе **магистры**)

### пример

файл `specialists/1994.txt`:

```
Агеев Александр Дмитриевич – ВТ
Андреенков Игорь Николаевич – ВТ
Антонов Владислав Николаевич – АТ
Ахаев Игорь Витальевич – АТ
Безверхий Виктор Викторович – ВТ
Боровиков Дмитрий Анатольевич – ЭП
Васев Дмитрий Юрьевич - ПТ
Денисенкова Маргарита Владимировна – ПТ
Егоров Андрей Михайлович – ВТ
Каблан Михаил Петрович – ПЭ
Канищев Олег Анатольевич – ОЭС
Кораблёв Игорь Геннадьевич – ПЭ
Кукшинова Нина Петровна – ПЭ
Кулаев Андрей Викторович – АТП
Кунцев Дмитрий Анатольевич – ВТ
Липкин Олег Леонидович – АТ
Лукьянова Лариса Евгеньевна – ПЭ
Медведев Сергей Алексеевич – ПЭ
Мелькин Алексей Эдуардович – АТ
Моисеенков Сергей Владимирович – ПЭ
Муханов Юрий Анатольевич – ОЭС
Олейкин Андрей Викторович – АТ
Павлов Дмитрий Анатольевич – ВТ
Пучков Сергей Юрьевич – АТ
Расторгуев Владимир Вячеславович – ВТ
Рысин Александр Геннадьевич – ПЭ
Северов Андрей Владимирович – ПЭ
Селезнев Сергей Алексеевич – АТП
Семёнов Сергей Андреевич – ПЭ
Сергеенков Максим Андреевич – ВТ
Соловьёв Сергей Евгеньевич – АТ
Сырченков Валентин Анатольевич – ПЭ
Ульянов Дмитрий Викторович – ПЭ
Хряков Сергей Александрович – АТ
Шатков Василий Петрович – ПЭ

```

